# üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø –ü–†–û–ë–õ–ï–ú –° –î–ê–ù–ù–´–ú–ò - –í–ï–†–°–ò–Ø 2

## ‚ö° –ù–ê–ô–î–ï–ù–´ –ò –£–°–¢–†–ê–ù–ï–ù–´ –û–°–ù–û–í–ù–´–ï –ü–†–ò–ß–ò–ù–´ –ü–û–¢–ï–†–ò –î–ê–ù–ù–´–•!

### üî¥ **–ü–†–û–ë–õ–ï–ú–´, –ö–û–¢–û–†–´–ï –ë–´–õ–ò –ù–ê–ô–î–ï–ù–´:**

1. **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã `updateReferralCounts`** - –±—ã–ª–∏ –∏ –≤ userController, –∏ –≤ referralController
2. **–ò–∑–±—ã—Ç–æ—á–Ω—ã–µ –≤—ã–∑–æ–≤—ã** - –º–µ—Ç–æ–¥ –≤—ã–∑—ã–≤–∞–ª—Å—è –¥–≤–∞–∂–¥—ã –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
3. **–ü—Ä–æ–±–ª–µ–º–∞ —Å null –∑–Ω–∞—á–µ–Ω–∏—è–º–∏** - `level1Count.count` –º–æ–≥ –±—ã—Ç—å null –∏ –ø–æ—Ä—Ç–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
4. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π** - —Å–º–µ—à–∏–≤–∞–Ω–∏–µ —Å–∏–Ω—Ö—Ä–æ–Ω–ΩÔøΩÔøΩ—Ö –∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤
5. **–í–ª–æ–∂–µ–Ω–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏** - –∫–æ–Ω—Ñ–ª–∏–∫—Ç –º–µ–∂–¥—É coordinator –∏ db.transaction
6. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –≤—ã–∑–æ–≤—ã better-sqlite3** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `run` –≤–º–µ—Å—Ç–æ `exec` –¥–ª—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

### ‚úÖ **–ß–¢–û –ò–°–ü–†–ê–í–õ–ï–ù–û:**

## 1. üîß **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –≤ Database.js**
**–ë–´–õ–û** (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
```javascript
async beginTransaction() {
    this.db.exec('BEGIN TRANSACTION');  // –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –≤—ã–∑–æ–≤ –≤ async —Ñ—É–Ω–∫—Ü–∏–∏
}
```

**–°–¢–ê–õ–û** (–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
```javascript
beginTransaction() {
    this.db.exec('BEGIN TRANSACTION');  // –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –º–µ—Ç–æ–¥
}
```

## 2. üîß **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω InstanceCoordinator**
**–ë–´–õ–û** (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
```javascript
await this.db.run('BEGIN TRANSACTION');  // –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –º–µ—Ç–æ–¥ –¥–ª—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
```

**–°–¢–ê–õ–û** (–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
```javascript
this.db.db.exec('BEGIN TRANSACTION');  // –ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ better-sqlite3
```

## 3. ‚ùå **–£–¥–∞–ª–µ–Ω—ã –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã**
- –£–¥–∞–ª–µ–Ω `updateReferralCounts` –∏–∑ `userController.js`
- –û—Å—Ç–∞–≤–ª–µ–Ω —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –≤ `referralController.js`
- –£–±—Ä–∞–Ω—ã –∏–∑–±—ã—Ç–æ—á–Ω—ã–µ –≤—ã–∑–æ–≤—ã –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

## 4. üõ°Ô∏è **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –∑–∞—â–∏—Ç–∞ –æ—Ç null –∑–Ω–∞—á–µ–Ω–∏–π**
**–í referralController.js –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ**:
```javascript
// –ë–´–õ–û:
[level1Count.count, level2Count.count || 0, userId]  // –ü–µ—Ä–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –º–æ–≥–ª–æ –±—ã—Ç—å null

// –°–¢–ê–õ–û:
[level1Count.count || 0, level2Count.count || 0, userId]  // –û–±–∞ –∑–∞—â–∏—â–µ–Ω—ã
```

## 5. üö´ **–£–±—Ä–∞–Ω—ã –≤–ª–æ–∂–µ–Ω–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏**
**–ü–†–û–ë–õ–ï–ú–ê**: Coordinator —É–∂–µ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ—Å—Ç—å, –∞ –º–æ–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ `db.transaction` —Å–æ–∑–¥–∞–≤–∞–ª–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã.

**–†–ï–®–ï–ù–ò–ï**: –£–±—Ä–∞–Ω—ã –≤—Å–µ `db.transaction` –≤—ã–∑–æ–≤—ã. –¢–µ–ø–µ—Ä—å:
- Coordinator –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π (–ø–æ–∫—É–ø–∫–∞ –ø–∏—Ç–æ–º—Ü–µ–≤)
- –ü—Ä–æ—Å—Ç—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –æ–±—ã—á–Ω—ã–º–∏ –∑–∞–ø—Ä–æ—Å–∞–º–∏
- –ù–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –º–µ–∂–¥—É —Ä–∞–∑–Ω—ã–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

## 6. üîç **–†–µ–∑—É–ª—å—Ç–∞—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:**

### –î–û –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
- –ú–µ—Ç–æ–¥ `updateReferralCounts` –º–æ–≥ –∑–∞–ø–∏—Å–∞—Ç—å null –≤ level1_referrals
- –≠—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ ÔøΩÔøΩ "–∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏—é" —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤ –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –ø—Ä–æ—Å–º–æ—Ç—Ä–µ –ø—Ä–æ—Ñ–∏–ª—è
- –í–ª–æ–∂–µ–Ω–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –º–æ–≥–ª–∏ –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ rollback –ø–æ–∫—É–ø–æ–∫ –ø–∏—Ç–æ–º—Ü–µ–≤
- –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤—ã–∑–æ–≤—ã –º–æ–≥–ª–∏ –ø–æ—Ä—Ç–∏—Ç—å –¥–∞–Ω–Ω—ã–µ

### –ü–û–°–õ–ï –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
- ‚úÖ **–ï–¥–∏–Ω—ã–π –º–µ—Ç–æ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤** —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç null
- ‚úÖ **–ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏** –±–µ–∑ –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏
- ‚úÖ **–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ better-sqlite3**
- ‚úÖ **–ù–µ—Ç –∏–∑–±—ã—Ç–æ—á–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π** –¥–∞–Ω–Ω—ã—Ö

## üéØ **–°–ü–ï–¶–ò–§–ò–ß–ï–°–ö–ò–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø –î–õ–Ø –í–ê–®–ò–• –ü–†–û–ë–õ–ï–ú:**

### üü° **–ü—Ä–æ–±–ª–µ–º–∞ 1: "–†–µ—Ñ–µ—Ä–∞–ª—ã –ø—Ä–æ–ø–∞–¥–∞—é—Ç –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –∑–∞—Ö–æ–¥–µ –≤ –ø—Ä–æ—Ñ–∏–ª—å"**
**–ü—Ä–∏—á–∏–Ω–∞**: –ú–µ—Ç–æ–¥ `updateReferralCounts` –∑–∞–ø–∏—Å—ã–≤–∞–ª null –≤–º–µ—Å—Ç–æ —á–∏—Å–ª–∞
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞—â–∏—Ç–∞ `|| 0` –∏ —É–±—Ä–∞–Ω—ã –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤—ã–∑–æ–≤—ã

### üü° **–ü—Ä–æ–±–ª–µ–º–∞ 2: "–ö—É–ø–ª–µ–Ω–Ω—ã–µ –ø–∏—Ç–æ–º—Ü—ã –∏—Å—á–µ–∑–∞—é—Ç"**
**–ü—Ä–∏—á–∏–Ω–∞**: –í–ª–æ–∂–µ–Ω–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ø—Ä–∏–≤–æ–¥–∏–ª–∏ –∫ rollback –æ–ø–µ—Ä–∞—Ü–∏–π
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**: –£–±—Ä–∞–Ω—ã –∫–æ–Ω—ÑÔøΩÔøΩ–∏–∫—Ç—É—é—â–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, coordinator –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å

## üîß **–¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –î–ï–¢–ê–õ–ò:**

### Coordinator vs Database —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:
- **Coordinator**: –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –º–µ–∂–¥—É —ç–∫–∑–µ–º–ø–ª—è—Ä–∞–º–∏ –±–æ—Ç–∞ + —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- **Database**: –ü—Ä–æ—Å—Ç—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ù–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤, –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∞—Ç–æ–º–∞—Ä–Ω—ã

### Better-sqlite3 –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–æ–ª–∂–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `exec()`, –Ω–µ `run()`
- –ú–µ—Ç–æ–¥—ã —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º–∏
- –ù–µ–ª—å–∑—è –Ω–∞—á–∏–Ω–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –≤–Ω—É—Ç—Ä–∏ —É–∂–µ –Ω–∞—á–∞—Ç–æ–π

## üöÄ **–ò–ù–°–¢–†–£–ö–¶–ò–ò:**

1. **–û–±–Ω–æ–≤–∏—Ç–µ –∫–æ–¥ –Ω–∞ GitHub**
2. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç –≤ Railway**
3. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ**:
   - –ü—Ä–∏–≥–ª–∞—Å–∏—Ç–µ —Ä–µ—Ñ–µ—Ä–∞–ª–∞ ‚Üí –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –æ—Å—Ç–∞—é—Ç—Å—è –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –∑–∞—Ö–æ–¥–µ –≤ –ø—Ä–æ—Ñ–∏–ª—å
   - –ö—É–ø–∏—Ç–µ –ø–∏—Ç–æ–º—Ü–∞ ‚Üí –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –æ–Ω –æ—Å—Ç–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –ø–æ–∫—É–ø–∫–∏

## üìä **–ü–†–û–í–ï–†–ö–ê –†–ê–ë–û–¢–´:**

### –¢–µ—Å—Ç —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤:
1. –ü—Ä–∏–≥–ª–∞—Å–∏—Ç–µ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–µ
2. –ó–∞–π–¥–∏—Ç–µ –≤ –ø—Ä–æ—Ñ–∏–ª—å - –¥–æ–ª–∂–Ω—ã –ø–æ–∫–∞–∑–∞—Ç—å—Å—è 1 —Ä–µ—Ñ–µ—Ä–∞–ª –∏ +3 –∑–≤–µ–∑–¥—ã
3. –í—ã–π–¥–∏—Ç–µ –∏–∑ –ø—Ä–æ—Ñ–∏–ª—è –∏ –∑–∞–π–¥–∏—Ç–µ —Å–Ω–æ–≤–∞
4. **–î–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã –æ—Å—Ç–∞—Ç—å—Å—è –Ω–∞ –º–µ—Å—Ç–µ!**

### –¢–µ—Å—Ç –ø–∏—Ç–æ–º—Ü–µ–≤:
1. –ö—É–ø–∏—Ç–µ –ª—é–±–æ–≥–æ –ø–∏—Ç–æ–º—Ü–∞
2. –í—ã–π–¥–∏—Ç–µ –∏–∑ –º–∞–≥–∞–∑–∏–Ω–∞ 
3. –ó–∞–π–¥–∏—Ç–µ –≤ "–ú–æ–∏ –ø–∏—Ç–æ–º—Ü—ã"
4. **–ü–∏—Ç–æ–º–µ—Ü –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ —Å–ø–∏—Å–∫–µ!**

**üéâ –í–°–ï –û–°–ù–û–í–ù–´–ï –ü–†–ò–ß–ò–ù–´ –ü–û–¢–ï–†–ò –î–ê–ù–ù–´–• –£–°–¢–†–ê–ù–ï–ù–´! üéâ**

–¢–µ–ø–µ—Ä—å –¥–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏ –Ω–µ "–∏—Å—á–µ–∑–∞—Ç—å" –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞—Ö–æ–¥–∞—Ö.
